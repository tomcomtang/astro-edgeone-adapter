# EdgeOne Astro Adapter

è¿™æ˜¯ä¸€ä¸ªç”¨äºå°† Astro é¡¹ç›®éƒ¨ç½²åˆ° EdgeOne Pages çš„é€‚é…å™¨ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
adapter/
â”œâ”€â”€ package.json          # åŒ…é…ç½®
â”œâ”€â”€ tsconfig.json         # TypeScript é…ç½®
â”œâ”€â”€ README.md             # æ–‡æ¡£
â””â”€â”€ src/                  # æºä»£ç ç›®å½•
    â”œâ”€â”€ index.ts          # ä¸»å…¥å£
    â”œâ”€â”€ server.ts         # æœåŠ¡ç«¯å®ç°
    â””â”€â”€ lib/              # åŠŸèƒ½æ¨¡å—
        â”œâ”€â”€ constants.ts
        â”œâ”€â”€ types.ts
        â”œâ”€â”€ dependencies.ts
        â”œâ”€â”€ optimizer.ts
        â”œâ”€â”€ config.ts
        â”œâ”€â”€ server-entry.ts
        â””â”€â”€ index.ts
```

## åŠŸèƒ½

- âœ… æ”¯æŒ SSR (Server-Side Rendering)
- âœ… æ”¯æŒé™æ€ç«™ç‚¹ç”Ÿæˆ (SSG)
- âœ… æ”¯æŒæ··åˆæ¨¡å¼ (Hybrid)
- âœ… æ„å»ºè¾“å‡ºåˆ° `.edgeone` ç›®å½•
- âœ… ä½¿ç”¨ `@vercel/nft` æ™ºèƒ½åˆ†æä¾èµ–ï¼ˆå‡å°‘ 81% ä½“ç§¯ï¼‰
- âœ… ç”Ÿæˆç²¾ç®€çš„ package.json
- âœ… è‡ªåŠ¨ä¼˜åŒ–ä»£ç ä½“ç§¯
- âœ… è‡ªåŠ¨ç”ŸæˆæœåŠ¡å™¨å…¥å£æ–‡ä»¶ï¼ˆç›‘å¬ç«¯å£ 9000ï¼‰
- âœ… å‡†å¤‡å¥½éƒ¨ç½²åˆ° EdgeOne Pages

## ä½¿ç”¨æ–¹æ³•

åœ¨ `astro.config.mjs` ä¸­å¼•å…¥å¹¶é…ç½®é€‚é…å™¨ï¼š

```javascript
import { defineConfig } from "astro/config";
import edgeone from "./adapter/index.ts";

export default defineConfig({
  output: "server", // æˆ– 'hybrid' æˆ– 'static'
  adapter: edgeone({
    outDir: ".edgeone", // å¯é€‰ï¼Œé»˜è®¤ä¸º '.edgeone'
  }),
});
```

## æ„å»º

è¿è¡Œæ„å»ºå‘½ä»¤ï¼š

```bash
npm run build
```

æ„å»ºç»“æœå°†è¾“å‡ºåˆ° `.edgeone` ç›®å½•ï¼š

```
.edgeone/
â”œâ”€â”€ assets/           # é™æ€èµ„æº
â”œâ”€â”€ server-handler/   # æœåŠ¡ç«¯ä»£ç 
â”‚   â”œâ”€â”€ node_modules/ # å¿…è¦çš„ä¾èµ–åŒ…
â”‚   â”œâ”€â”€ package.json  # ç²¾ç®€çš„ä¾èµ–é…ç½®
â”‚   â””â”€â”€ ...           # æœåŠ¡ç«¯å…¥å£å’Œèµ„æº
â””â”€â”€ meta.json         # è·¯ç”±é…ç½®ä¿¡æ¯
```

## ä¼˜åŒ–åŠŸèƒ½

é€‚é…å™¨ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹ä¼˜åŒ–ï¼š

1. **æ™ºèƒ½ä¾èµ–åˆ†æ**: ä½¿ç”¨ `@vercel/nft` (Node File Trace) é™æ€åˆ†æä»£ç 

   - åªæ‹·è´è¿è¡Œæ—¶çœŸæ­£éœ€è¦çš„æ–‡ä»¶
   - ç›¸æ¯”ä¼ ç»Ÿæ–¹æ³•å‡å°‘ **81%** çš„ä½“ç§¯ï¼ˆä» 90MB é™åˆ° 17MBï¼‰
   - æ”¯æŒåŠ¨æ€ require/import åˆ†æ
   - è‡ªåŠ¨å¤„ç† native æ¨¡å—å’ŒäºŒè¿›åˆ¶æ–‡ä»¶

2. **ç²¾ç®€é…ç½®**: ç”Ÿæˆæœ€å°åŒ–çš„ `package.json`ï¼ŒåªåŒ…å«å¿…è¦çš„ä¾èµ–

3. **ä½“ç§¯ä¼˜åŒ–**: è‡ªåŠ¨åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼š

   - Source maps (`.map` æ–‡ä»¶)
   - TypeScript å£°æ˜æ–‡ä»¶ (`.d.ts`)
   - æ–‡æ¡£æ–‡ä»¶ (README, CHANGELOG, LICENSE)
   - æµ‹è¯•æ–‡ä»¶å’Œç›®å½•
   - ç¤ºä¾‹ä»£ç 

4. **æœåŠ¡å™¨å…¥å£**: è‡ªåŠ¨ç”Ÿæˆ `index.mjs` å¯åŠ¨æ–‡ä»¶
   - ç›‘å¬ç«¯å£ 9000
   - æ”¯æŒæµå¼å“åº”
   - å®Œæ•´çš„é”™è¯¯å¤„ç†
   - Web Crypto API polyfill

### æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡       | ä¼ ç»Ÿæ–¹æ³• | @vercel/nft | ä¼˜åŒ–æ•ˆæœ |
| ---------- | -------- | ----------- | -------- |
| ä¾èµ–ä½“ç§¯   | 90MB     | 17MB        | â†“ 81%    |
| æ‹·è´æ–‡ä»¶æ•° | 290 ä¸ªåŒ… | 141 ä¸ªæ–‡ä»¶  | â†“ 51%    |
| éœ€åˆ é™¤æ–‡ä»¶ | 2951 ä¸ª  | 1 ä¸ª        | â†“ 99.97% |

## æœ¬åœ°æµ‹è¯•

æ„å»ºå®Œæˆåï¼Œå¯ä»¥åœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡å™¨æµ‹è¯•ï¼š

```bash
cd .edgeone/server-handler
node index.mjs
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:9000` å¯åŠ¨ã€‚

## éƒ¨ç½²åˆ° EdgeOne Pages

æ„å»ºå®Œæˆåï¼Œå°† `.edgeone` ç›®å½•çš„å†…å®¹éƒ¨ç½²åˆ° EdgeOne Pages å³å¯ã€‚
