---
// actions.astro - Astro Actions æ¥å£æ³¨å†Œç¤ºä¾‹é¡µé¢
import Layout from "../layouts/BlogPost.astro";
---

<Layout
  title="Astro Actions æ¥å£æ³¨å†Œç¤ºä¾‹"
  description="å±•ç¤ºå¦‚ä½•åœ¨ Astro EdgeOne é€‚é…å™¨ä¸­ä½¿ç”¨ Actions æ¥å£æ³¨å†ŒåŠŸèƒ½"
  pubDate={new Date()}
>
  <div class="wrapper">
    <h1>Astro Actions æ¥å£æ³¨å†Œç¤ºä¾‹</h1>

    <p class="text-lg">
      è¿™ä¸ªé¡µé¢å±•ç¤ºäº†å¦‚ä½•åœ¨ Astro EdgeOne é€‚é…å™¨ä¸­ä½¿ç”¨ Actions æ¥å£æ³¨å†ŒåŠŸèƒ½ã€‚
    </p>

    <div class="actions-demo">
      <h2>ğŸ“‹ Actions æ¥å£ç¤ºä¾‹</h2>

      <div class="action-item">
        <h3>1. ç”¨æˆ·æ³¨å†Œæ¥å£</h3>
        <div class="code-block">
          <pre><code>{`POST /api/register
Content-Type: application/json

{
  "username": "user123",
  "email": "user@example.com",
  "password": "securepassword"
}`}</code></pre>
        </div>
        <p class="description">
          ç”¨æˆ·æ³¨å†Œæ¥å£ï¼Œæ¥æ”¶ç”¨æˆ·åã€é‚®ç®±å’Œå¯†ç ï¼Œè¿”å›æ³¨å†Œç»“æœã€‚
        </p>
      </div>

      <div class="action-item">
        <h3>2. ç”¨æˆ·ç™»å½•æ¥å£</h3>
        <div class="code-block">
          <pre><code>{`POST /api/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "securepassword"
}`}</code></pre>
        </div>
        <p class="description">
          ç”¨æˆ·ç™»å½•æ¥å£ï¼ŒéªŒè¯é‚®ç®±å’Œå¯†ç ï¼Œè¿”å› JWT tokenã€‚
        </p>
      </div>

      <div class="action-item">
        <h3>3. è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£</h3>
        <div class="code-block">
          <pre><code>{`GET /api/user/profile
Authorization: Bearer <JWT_TOKEN>`}</code></pre>
        </div>
        <p class="description">è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
      </div>

      <div class="action-item">
        <h3>4. æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ¥å£</h3>
        <div class="code-block">
          <pre><code>{`PUT /api/user/profile
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json

{
  "username": "newusername",
  "bio": "Updated bio"
}`}</code></pre>
        </div>
        <p class="description">æ›´æ–°ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚</p>
      </div>

      <div class="action-item">
        <h3>5. æ–‡ä»¶ä¸Šä¼ æ¥å£</h3>
        <div class="code-block">
          <pre><code>{`POST /api/upload
Authorization: Bearer <JWT_TOKEN>
Content-Type: multipart/form-data

file: [binary data]`}</code></pre>
        </div>
        <p class="description">æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼Œæ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ç­‰æ–‡ä»¶ç±»å‹ã€‚</p>
      </div>
    </div>

    <div class="implementation-guide">
      <h2>ğŸ› ï¸ å®ç°æŒ‡å—</h2>

      <h3>1. åˆ›å»º Actions æ–‡ä»¶</h3>
      <p>åœ¨ <code>src/actions/</code> ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„ action æ–‡ä»¶ï¼š</p>
      <div class="code-block">
        <pre><code>{`// src/actions/user.ts
export async function registerUser(formData: FormData) {
  const username = formData.get('username') as string;
  const email = formData.get('email') as string;
  const password = formData.get('password') as string;
  
  // éªŒè¯è¾“å…¥
  if (!username || !email || !password) {
    return { success: false, error: 'Missing required fields' };
  }
  
  // å¤„ç†æ³¨å†Œé€»è¾‘
  try {
    // è¿™é‡Œæ·»åŠ ä½ çš„æ³¨å†Œé€»è¾‘
    return { success: true, message: 'User registered successfully' };
  } catch (error) {
    return { success: false, error: 'Registration failed' };
  }
}`}</code></pre>
      </div>

      <h3>2. åœ¨é¡µé¢ä¸­ä½¿ç”¨ Actions</h3>
      <div class="code-block">
        <pre><code>{`<!-- src/pages/register.astro -->
---
import { registerUser } from '../actions/user.ts';
---

<form method="POST" action={registerUser}>
  <input name="username" placeholder="Username" required />
  <input name="email" type="email" placeholder="Email" required />
  <input name="password" type="password" placeholder="Password" required />
  <button type="submit">Register</button>
</form>`}</code></pre>
      </div>

      <h3>3. EdgeOne é€‚é…å™¨é…ç½®</h3>
      <p>ç¡®ä¿åœ¨ <code>meta.json</code> ä¸­æ­£ç¡®é…ç½®è·¯ç”±ï¼š</p>
      <div class="code-block">
        <pre><code>{`{
  "nextRoutes": [
    {
      "path": "^/api/.*$",
      "srcRoute": "/api/[...slug]"
    }
  ]
}`}</code></pre>
      </div>
    </div>

    <div class="testing-section">
      <h2>ğŸ§ª æµ‹è¯•ç¤ºä¾‹</h2>

      <h3>ä½¿ç”¨ curl æµ‹è¯•</h3>
      <div class="code-block">
        <pre><code>{`# æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
curl -X POST https://your-domain.edgeone.run/api/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@example.com","password":"testpass"}'

# æµ‹è¯•ç”¨æˆ·ç™»å½•
curl -X POST https://your-domain.edgeone.run/api/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"testpass"}'`}</code></pre>
      </div>

      <h3>ä½¿ç”¨ JavaScript fetch</h3>
      <div class="code-block">
        <pre><code>{`// æ³¨å†Œç”¨æˆ·
const registerResponse = await fetch('/api/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: 'testuser',
    email: 'test@example.com',
    password: 'testpass'
  })
});

const registerResult = await registerResponse.json();
console.log(registerResult);`}</code></pre>
      </div>
    </div>

    <div class="best-practices">
      <h2>âœ¨ æœ€ä½³å®è·µ</h2>

      <ul>
        <li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå§‹ç»ˆéªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œé˜²æ­¢æ¶æ„æ•°æ®</li>
        <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’ŒçŠ¶æ€ç </li>
        <li>
          <strong>å®‰å…¨æ€§</strong>ï¼šä½¿ç”¨ HTTPSï¼ŒéªŒè¯ JWT tokenï¼Œé˜²æ­¢ CSRF æ”»å‡»
        </li>
        <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ç¼“å­˜ï¼Œä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢</li>
        <li><strong>æ—¥å¿—è®°å½•</strong>ï¼šè®°å½•é‡è¦çš„æ“ä½œå’Œé”™è¯¯</li>
        <li><strong>API æ–‡æ¡£</strong>ï¼šæä¾›å®Œæ•´çš„ API æ–‡æ¡£å’Œç¤ºä¾‹</li>
      </ul>
    </div>

    <div class="navigation">
      <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
      <a href="/blog" class="next-link">æŸ¥çœ‹åšå®¢ â†’</a>
    </div>
  </div>
</Layout>

<style>
  .actions-demo {
    margin: 2rem 0;
  }

  .action-item {
    margin: 2rem 0;
    padding: 1.5rem;
    border: 1px solid var(--theme-border);
    border-radius: 8px;
    background: var(--theme-bg-secondary);
  }

  .action-item h3 {
    margin-top: 0;
    color: var(--theme-accent);
  }

  .code-block {
    background: var(--theme-bg-code);
    border: 1px solid var(--theme-border);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
    overflow-x: auto;
  }

  .code-block pre {
    margin: 0;
    font-family: "Fira Code", "Monaco", "Consolas", monospace;
    font-size: 0.9rem;
    line-height: 1.5;
  }

  .code-block code {
    color: var(--theme-text-code);
  }

  .description {
    margin-top: 1rem;
    color: var(--theme-text-secondary);
    font-style: italic;
  }

  .implementation-guide,
  .testing-section,
  .best-practices {
    margin: 3rem 0;
    padding: 2rem;
    background: var(--theme-bg-secondary);
    border-radius: 12px;
  }

  .implementation-guide h3,
  .testing-section h3 {
    color: var(--theme-accent);
    margin-top: 2rem;
  }

  .implementation-guide h3:first-child,
  .testing-section h3:first-child {
    margin-top: 0;
  }

  .best-practices ul {
    list-style: none;
    padding: 0;
  }

  .best-practices li {
    margin: 1rem 0;
    padding-left: 1.5rem;
    position: relative;
  }

  .best-practices li::before {
    content: "âœ“";
    position: absolute;
    left: 0;
    color: var(--theme-accent);
    font-weight: bold;
  }

  .navigation {
    margin: 3rem 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .back-link,
  .next-link {
    padding: 0.75rem 1.5rem;
    background: var(--theme-accent);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    transition: background-color 0.2s;
  }

  .back-link:hover,
  .next-link:hover {
    background: var(--theme-accent-hover);
  }

  @media (max-width: 768px) {
    .navigation {
      flex-direction: column;
      gap: 1rem;
    }

    .code-block {
      font-size: 0.8rem;
    }
  }
</style>
